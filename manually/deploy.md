# Deploying to testnet/mainnet

This guide uses Foundry to deploy your dApp to a testnet or mainnet.

:::info Ensure Foundry is installed and accessible:

```bash
forge --version
```

If you don't have Foundry installed, please refer to the [installation guide](../installation.md) and set it up before proceeding.
:::

## Step 1: Build your dApp

Inside your dApp directory run

```bash
cartesi build
```

## Step 2: Run CARize Utility Container

After building your dApp, use the CARize container to generate the necessary files:

```bash
docker run --rm \
    -v $(pwd)/.cartesi/image:/data \
    -v $(pwd):/output \
    carize:latest /carize.sh
```

## Step 3: Set Environment Variables

Set the environment variables using the output files generated by `carize.sh`:

```bash
CID=$(cat output.cid)
SIZE=$(cat output.size)
MACHINE_HASH=$(xxd -p .cartesi/image/hash | tr -d '\n')
```

## Step 4: Upload CAR Files to Web3.Storage

Log in to Web3.Storage

```bash
w3 login yourEmail@example.com
```

Create a Storage Space

```bash
w3 space create preferredSpaceName
```

Upload CAR Files

```bash
w3 up --car output.car
```

## Step 5: Ensure Coprocessor Has Your Program

Finally, notify the Coprocessor to register your program:

```bash
curl -X POST "https://cartesi-coprocessor-solver.fly.dev/ensure/$CID/$MACHINE_HASH/$SIZE"
```

## Step 6: Deploy the Smart Contract

```bash
forge create --broadcast \
      --rpc-url <your_rpc_url> \
      --private-key <your_private_key> \
      ./src/CoprocessorAdapterSample.sol:CoprocessorAdapterSample \
      --constructor-args <coprocessor_address> <machine_hash>
```

:::info Where to get the values:

- **RPC URL**: Obtain this from an RPC Provider like Alchemy.
- **Coprocessor Address**: Obtain this value from the `task_issuer` in `config-devnet.toml`.
- **Machine Hash**: Obtain this from the Cartesi backend deployment output. You can get it from the environment variables set in step 3.
  :::

:::tip
Save the deployed contract address for frontend interaction.
:::
