# Building and Running Locally

You can set up and run your project either using the Co-Processor CLI or manually. Follow the instructions below based on your preferred approach.

---

## Option 1: Using Co-Processor CLI

### Bootstrap a Project
1. Create a new Cartesi dApp project:
   ```bash
   cartesi-coprocessor create --dapp-name <project_name> --template <go, python, javascript, rust>
   cd my-cartesi-project
   ```

2. Implement your business logic:
   - Edit the pre-generated child contract in the `src` folder to customize your logic.

:::info
Run the Cartesi Coprocessor Devnet Environment

1. Clone the Cartesi Coprocessor repository:
   ```bash
   cartesi-coprocessor start-devnet
   ```

   > To stop and clean up the environment later, use:
   ```bash
   cartesi-coprocessor stop-devnet
   ```
:::

### Register the Program
   Register your program with the Co-Processor:
   ```bash
   cartesi-coprocessor register --email <w3 storage account email> --network <devnet, mainnet or testnet>
```

3. Check Status:

   ```bash
   cartesi-coprocessor check-status --network <devnet, mainnet or testnet>
   ```

   Checks with the coprocessor task issuer for the status of the machine download process
   > Note: this should be run in the directory for your Cartesi program not the base directory or the solidity contract directory

---

## Option 2: Manual Setup

### Step 1: Run Nonodo with Cartesi Machine

1. **Start Nonodo**:
   ```bash
   nonodo
   ```

2. **Create and Build a New Cartesi dApp**:
   - Use the commands below based on your preferred programming language.

---

#### **Python**
1. Create a new project:
   ```bash
   cartesi create my-dapp --template=python --branch "wip/coprocessor"
   cd my-dapp
   cartesi build
   ```
2. Run the Cartesi Machine locally:
   ```bash
   cartesi-machine --network --flash-drive=label:root,filename:.cartesi/image.ext2 \
   --volume=.:/mnt --env=ROLLUP_HTTP_SERVER_URL=http://10.0.2.2:5004 --workdir=/mnt -- python dapp.py
   ```

---

#### **Rust**
1. Create a new project:
   ```bash
   cartesi create my-dapp --template=rust --branch "wip/coprocessor"
   cd my-dapp
   cartesi build
   ```
2. Run the Cartesi Machine locally:
   ```bash
   cartesi-machine --network --flash-drive=label:root,filename:.cartesi/image.ext2 \
   --env=ROLLUP_HTTP_SERVER_URL=http://10.0.2.2:5004 -- /opt/cartesi/dapp/dapp
   ```

---

#### **Go**
1. Create a new project:
   ```bash
   cartesi create my-dapp --template=go --branch "wip/coprocessor"
   cd my-dapp
   cartesi build
   ```
2. Run the Cartesi Machine locally:
   ```bash
   cartesi-machine --network --flash-drive=label:root,filename:.cartesi/image.ext2 \
   --env=ROLLUP_HTTP_SERVER_URL=http://10.0.2.2:5004 -- /opt/cartesi/dapp/dapp
   ```

---

#### **JavaScript**
1. Create a new project:
   ```bash
   cartesi create my-dapp --template=javascript --branch "wip/coprocessor"
   cd my-dapp
   cartesi build
   ```
2. Run the Cartesi Machine locally:
   ```bash
   cartesi-machine --network --flash-drive=label:root,filename:.cartesi/image.ext2 \
   --volume=.:/mnt --env=ROLLUP_HTTP_SERVER_URL=http://10.0.2.2:5004 --workdir=/opt/cartesi/dapp -- node index
   ```

---

### Step 2: Run CARize Utility Container

After building your dApp, use the CARize container to generate the necessary files:

```bash
docker run --rm \
    -v $(pwd)/.cartesi/image:/data \
    -v $(pwd):/output \
    carize:latest /carize.sh
```

---

### Step 3: Set Environment Variables

Set the environment variables using the output files generated by `carize.sh`:

```bash
CID=$(cat output.cid)
SIZE=$(cat output.size)
MACHINE_HASH=$(xxd -p .cartesi/image/hash | tr -d '\n')
```

---

### Step 4: Upload CAR Files to Web3.Storage

1. **Log in to Web3.Storage**:
   ```bash
   w3 login yourEmail@example.com
   ```

2. **Create a Storage Space**:
   ```bash
   w3 space create preferredSpaceName
   ```

3. **Upload CAR Files**:
   ```bash
   w3 up --car output.car
   ```

---

### Step 5: Ensure Co-Processor Has Your Program

Finally, notify the Co-Processor to register your program:
```bash
curl -X POST "https://cartesi-coprocessor-solver.fly.dev/ensure/$CID/$MACHINE_HASH/$SIZE"
```
